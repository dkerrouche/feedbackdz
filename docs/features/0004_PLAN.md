# Charts and Response Management Implementation

## Description
Complete the real-time dashboard by implementing interactive data visualization charts and comprehensive response management features. This includes installing Recharts for data visualization, creating rating distribution charts, sentiment analysis visualizations, trends over time, response filtering and search capabilities, individual response management actions, and CSV export functionality.

## Files to Modify

### 1. Charts and Visualization Setup
**Files:**
- `package.json` - Add Recharts dependency
- `src/components/dashboard/charts/RatingChart.tsx` - Rating distribution pie/bar chart
- `src/components/dashboard/charts/SentimentChart.tsx` - Sentiment analysis gauge and breakdown
- `src/components/dashboard/charts/TrendsChart.tsx` - Response trends over time
- `src/components/dashboard/charts/KeywordsChart.tsx` - Keyword frequency visualization
- `src/components/dashboard/DashboardCharts.tsx` - Main charts container component

**Changes:**
- Install and configure Recharts library for data visualization
- Create responsive chart components with mobile/desktop layouts
- Implement rating distribution pie chart (1-5 stars)
- Build sentiment analysis gauge showing positive/neutral/negative breakdown
- Create trends line chart showing responses over time (daily/weekly/monthly)
- Add keyword frequency bar chart or word cloud
- Ensure all charts are responsive and accessible

### 2. Response Management Components
**Files:**
- `src/components/dashboard/ResponseItem.tsx` - Individual response display with full details
- `src/components/dashboard/ResponseActions.tsx` - Response action buttons (mark as addressed, flag, delete)
- `src/components/dashboard/ResponseFilters.tsx` - Advanced filtering and search interface
- `src/components/dashboard/ResponseModal.tsx` - Modal for detailed response view
- `src/components/dashboard/ExportButton.tsx` - CSV/PDF export functionality

**Changes:**
- Create detailed response display with transcription, audio playback, metadata
- Add response management actions (mark as addressed, flag as important, delete)
- Implement advanced filtering by date range, rating, sentiment, search text
- Build response detail modal with full information and actions
- Create export functionality for CSV download with current filter state

### 3. API Endpoints for Response Management
**Files:**
- `src/app/api/responses/[id]/route.ts` - Response update API (PATCH, DELETE)
- `src/app/api/responses/export/route.ts` - CSV export API endpoint
- `src/lib/export.ts` - Export utility functions for CSV generation

**Changes:**
- Create PATCH endpoint to update response status (addressed, flagged, etc.)
- Build DELETE endpoint for response deletion with proper authorization
- Implement CSV export API with filtering support
- Add export utility functions for data formatting and CSV generation
- Ensure proper RLS policies for response management operations

### 4. Dashboard Integration and Polish
**Files:**
- `src/app/dashboard/page.tsx` - Integrate charts and response management
- `src/components/dashboard/DashboardLayout.tsx` - Enhanced dashboard layout
- `src/hooks/useResponseFilters.ts` - Custom hook for filter state management
- `src/hooks/useExport.ts` - Custom hook for export functionality

**Changes:**
- Integrate all chart components into dashboard overview tab
- Add response management features to the dashboard
- Create enhanced dashboard layout with proper spacing and organization
- Implement filter state management with URL persistence
- Add export functionality with loading states and error handling

## Algorithm

### Chart Data Processing
1. Fetch responses for business within selected date range
2. Group responses by rating (1-5 stars) for distribution chart
3. Calculate sentiment breakdown (positive/neutral/negative percentages)
4. Aggregate responses by time period (daily/weekly/monthly) for trends
5. Extract and count keywords from transcriptions for keyword chart
6. Apply current filters to all chart data before rendering

### Response Management Flow
1. User clicks on response → Open detailed response modal
2. User applies filters → Recalculate all charts and response list
3. User marks response as addressed → Update database and refresh UI
4. User exports data → Generate CSV with current filter state
5. User searches responses → Filter by transcription text content

### Export Functionality
1. User clicks export → Show export options (CSV, date range, filters)
2. Apply current filters to response data
3. Format data for CSV export (headers, data rows, proper encoding)
4. Generate downloadable CSV file with timestamp
5. Show success/error feedback to user

## Implementation Phases

### Phase 1: Charts and Visualization
- Install Recharts dependency and configure
- Create basic chart components (RatingChart, SentimentChart, TrendsChart)
- Implement responsive chart designs for mobile/desktop
- Add chart data processing and filtering logic

### Phase 2: Response Management
- Create ResponseItem component with detailed display
- Build ResponseActions component with management buttons
- Implement ResponseFilters component for search and filtering
- Add ResponseModal for detailed response view

### Phase 3: API and Export
- Create response update API endpoints (PATCH, DELETE)
- Implement CSV export API with filtering support
- Build export utility functions for data formatting
- Add proper error handling and validation

### Phase 4: Dashboard Integration
- Integrate all components into main dashboard
- Add filter state management with URL persistence
- Implement export functionality with loading states
- Polish UI and add loading/error states

## Technical Details

### Chart Components Structure
```typescript
interface ChartProps {
  data: AnalyticsData
  filters: ResponseFilters
  loading?: boolean
  className?: string
}

// RatingChart - Pie chart showing 1-5 star distribution
// SentimentChart - Gauge showing positive/neutral/negative breakdown  
// TrendsChart - Line chart showing responses over time
// KeywordsChart - Bar chart or word cloud of extracted keywords
```

### Response Management Types
```typescript
interface ResponseAction {
  type: 'mark_addressed' | 'flag' | 'unflag' | 'delete'
  responseId: string
  businessId: string
}

interface ResponseFilters {
  dateRange: { start: Date; end: Date }
  rating: number[] // [1,2,3,4,5]
  sentiment: string[] // ['positive', 'neutral', 'negative']
  searchText: string
  surveyIds: string[]
}
```

### Export Data Structure
```typescript
interface ExportData {
  responses: RealtimeResponse[]
  filters: ResponseFilters
  exportDate: string
  businessId: string
  totalCount: number
}
```

### Filter System Features
- **Date Range**: Last 7 days, 30 days, 90 days, custom range picker
- **Rating Filter**: 1-2 stars, 3 stars, 4-5 stars, all ratings
- **Sentiment Filter**: Positive, neutral, negative, all sentiments
- **Search**: Full-text search in transcriptions and keywords
- **Survey Filter**: Filter by specific survey QR codes
- **Status Filter**: Addressed, flagged, all responses

### Chart Responsive Design
- **Mobile (< 768px)**: Single column layout, simplified charts
- **Tablet (768px - 1024px)**: Two column layout, medium complexity
- **Desktop (> 1024px)**: Multi-column layout, full feature charts
- **Accessibility**: Proper ARIA labels, keyboard navigation, screen reader support
