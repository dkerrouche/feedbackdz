# Dashboard Data Flow and Sample Data Implementation

## Description
Fix the dashboard data flow by ensuring proper analytics calculation, adding sample response data for testing, and implementing response management features. This includes creating sample data, fixing analytics calculation issues, implementing response filtering and search, and adding response management actions.

## Files to Modify

### 1. Sample Data and Database Setup
**Files:**
- `database/sample-responses.sql` - Sample response data for testing
- `database/setup-sample-data.sql` - Complete sample data setup script
- `src/lib/sample-data.ts` - Sample data generation utilities

**Changes:**
- Create comprehensive sample response data with various ratings, sentiments, and keywords
- Add sample data for different time periods to test trends
- Include audio responses with transcriptions for testing
- Generate realistic business scenarios and response patterns

### 2. Analytics Calculation Fixes
**Files:**
- `src/lib/analytics.ts` - Fix analytics calculation issues
- `src/hooks/useRealtimeResponses.ts` - Ensure proper data loading
- `src/app/dashboard/page.tsx` - Fix analytics loading and calculation

**Changes:**
- Fix analytics calculation to handle empty data gracefully
- Ensure proper data flow from responses to analytics
- Add debugging and logging for data flow issues
- Fix the missing analytics fields in the calculation

### 3. Response Management Components
**Files:**
- `src/components/dashboard/ResponseItem.tsx` - Individual response display
- `src/components/dashboard/ResponseActions.tsx` - Response action buttons
- `src/components/dashboard/ResponseFilters.tsx` - Filtering and search interface
- `src/components/dashboard/ResponseModal.tsx` - Detailed response modal

**Changes:**
- Create detailed response display with transcription and audio playback
- Add response management actions (mark as addressed, flag, delete)
- Implement advanced filtering by date, rating, sentiment, search
- Build response detail modal with full information

### 4. API Endpoints for Response Management
**Files:**
- `src/app/api/responses/[id]/route.ts` - Response update API (PATCH, DELETE)
- `src/app/api/responses/export/route.ts` - CSV export API
- `src/lib/export.ts` - Export utility functions

**Changes:**
- Create PATCH endpoint for response status updates
- Build DELETE endpoint for response deletion
- Implement CSV export with filtering support
- Add proper error handling and validation

### 5. Dashboard Integration and Polish
**Files:**
- `src/app/dashboard/page.tsx` - Fix analytics loading and display
- `src/hooks/useResponseFilters.ts` - Filter state management
- `src/hooks/useExport.ts` - Export functionality

**Changes:**
- Fix analytics loading and calculation issues
- Add proper loading states and error handling
- Implement filter state management
- Add export functionality with loading states

## Algorithm

### Sample Data Generation
1. Create realistic business scenarios (restaurant, cafe, fast food)
2. Generate responses across different time periods (last 30 days)
3. Include varied ratings (1-5 stars) with realistic distribution
4. Add sentiment analysis results (positive/neutral/negative)
5. Generate keywords from common restaurant feedback topics
6. Include both text and audio responses with transcriptions

### Analytics Data Flow
1. Load responses from database via useRealtimeResponses hook
2. Calculate analytics using calculateAnalytics function
3. Update charts with calculated data
4. Handle empty states and loading states properly
5. Ensure real-time updates work correctly

### Response Management Flow
1. Display responses in ResponseFeed component
2. Allow filtering by date, rating, sentiment, search text
3. Enable response actions (mark as addressed, flag, delete)
4. Show detailed response information in modal
5. Export filtered data to CSV

## Implementation Phases

### Phase 1: Sample Data and Database Fixes
- Create comprehensive sample response data
- Fix analytics calculation issues
- Ensure proper data loading in dashboard
- Test charts with real data

### Phase 2: Response Management UI
- Create ResponseItem component with detailed display
- Build ResponseActions component with management buttons
- Implement ResponseFilters component for search and filtering
- Add ResponseModal for detailed response view

### Phase 3: API and Export
- Create response update API endpoints
- Implement CSV export functionality
- Add export utility functions
- Test all API endpoints

### Phase 4: Dashboard Integration
- Fix analytics loading and display issues
- Add filter state management
- Implement export functionality
- Polish UI and add proper error handling

## Technical Details

### Sample Data Structure
```sql
-- Sample responses with realistic data
INSERT INTO responses (survey_id, business_id, rating, sentiment, transcription, keywords, created_at) VALUES
('survey-1', 'business-1', 5, 'positive', 'Great food and service!', ['food', 'service', 'great'], '2024-01-15'),
('survey-1', 'business-1', 4, 'positive', 'Good experience overall', ['experience', 'good'], '2024-01-14'),
-- ... more sample data
```

### Analytics Calculation Fixes
```typescript
// Ensure proper handling of empty data
export function calculateAnalytics(responses: RealtimeResponse[]): AnalyticsData {
  if (!responses || responses.length === 0) {
    return getEmptyAnalytics()
  }
  
  // Calculate all metrics properly
  // Handle missing fields gracefully
  // Ensure all chart data is populated
}
```

### Response Management Types
```typescript
interface ResponseAction {
  type: 'mark_addressed' | 'flag' | 'unflag' | 'delete'
  responseId: string
  businessId: string
}

interface ResponseFilters {
  dateRange: { start: Date; end: Date }
  rating: number[]
  sentiment: string[]
  searchText: string
  surveyIds: string[]
}
```

### Filter System Features
- **Date Range**: Last 7 days, 30 days, 90 days, custom range
- **Rating Filter**: 1-2 stars, 3 stars, 4-5 stars, all ratings
- **Sentiment Filter**: Positive, neutral, negative, all sentiments
- **Search**: Full-text search in transcriptions and keywords
- **Survey Filter**: Filter by specific survey QR codes
- **Status Filter**: Addressed, flagged, all responses

### Export Functionality
- **CSV Export**: All responses with current filters applied
- **Real-time Data**: Export includes latest data at time of export
- **Filtered Export**: Only export data matching current filter criteria
- **Proper Formatting**: Headers, data rows, proper encoding
