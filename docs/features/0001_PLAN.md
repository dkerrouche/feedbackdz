# Unified Text/Voice Input Interface

## Description
Unify text and voice input into a single chat-like interface where users can either type or record audio for open-ended questions. Remove the distinction between "text" and "voice" question types - all open-ended questions will have a unified input field with both text and microphone capabilities, similar to modern chat applications.

## Files to Modify

### 1. Question Type System
**Files:**
- `src/types/index.ts` - Update Question interface
- `src/lib/openai.ts` - Update survey generation prompt and types
- `src/app/api/ai/generate-survey/route.ts` - Update fallback questions

**Changes:**
- Remove `'voice'` from Question type union, keep only `'rating' | 'text'`
- Update AI prompt to generate only "rating" and "text" types
- All text questions will support both input methods

### 2. Survey Generation
**Files:**
- `src/lib/openai.ts` - Update `createSurveyPrompt()` function
- `src/components/survey/SurveyGenerator.tsx` - Remove voice type selector

**Changes:**
- Modify prompt to generate only rating + text questions
- Remove voice option from question type selector
- Update default questions to use only "text" type

### 3. Public Survey Interface
**Files:**
- `src/app/s/[qr_code]/page.tsx` - Complete rewrite of question rendering logic
- `src/components/voice/VoiceRecorder.tsx` - Integrate into unified input component

**Changes:**
- Create new `UnifiedTextInput` component that combines textarea + voice recording
- Remove separate handling for voice vs text questions
- All text questions render the unified input component
- Maintain existing voice recording functionality but embed it in text input

### 4. Response Processing
**Files:**
- `src/app/api/responses/route.ts` - Update response handling logic
- `src/app/s/[qr_code]/page.tsx` - Update form submission logic

**Changes:**
- Modify response submission to handle unified input (text + optional audio)
- Update background processing to handle both text and audio from same question
- Maintain existing AI processing pipeline

### 5. Database Schema
**Files:**
- `database/schema.sql` - No changes needed
- Current schema already supports both transcription and audio_url fields

## Algorithm

### Question Generation
1. AI generates exactly 3 questions: 1 rating + 2 text questions
2. All text questions support both typing and voice recording
3. No distinction in question type - all text questions are "unified"

### User Interface
1. Rating questions: Display star rating interface (unchanged)
2. Text questions: Display unified input component with:
   - Text area for typing
   - Microphone button for voice recording
   - Chat-like appearance with both options always available
   - Voice recording overlays or appears inline with text input

### Response Collection
1. User can type text, record voice, or both for each text question
2. If both text and voice provided, combine them in submission
3. If only voice provided, use transcription as text
4. If only text provided, submit as-is
5. Maintain existing AI processing for voice recordings

### Data Flow
1. Survey creation: Generate rating + text questions only
2. Survey display: Render rating + unified text input for each text question
3. Response submission: Collect rating + text/audio for each text question
4. Background processing: Process audio through existing Whisper + GPT pipeline
5. Storage: Store in existing responses table structure

## Implementation Phases

### Phase 1: Update Question Types
- Modify Question interface to remove 'voice' type
- Update AI generation prompt and fallback questions
- Update survey generator to remove voice type selector

### Phase 2: Create Unified Input Component
- Build UnifiedTextInput component combining textarea + voice recording
- Style it to look like modern chat input (WhatsApp/Telegram style)
- Integrate existing VoiceRecorder functionality

### Phase 3: Update Survey Display
- Modify public survey page to use unified input for all text questions
- Remove separate voice question handling
- Update form submission logic

### Phase 4: Update Response Processing
- Modify response API to handle unified input data
- Ensure background processing works with new data structure
- Test end-to-end flow

## Technical Details

### UnifiedTextInput Component Structure
```typescript
interface UnifiedTextInputProps {
  questionText: string
  value: string
  onChange: (text: string) => void
  onAudioRecorded: (audioBlob: Blob) => void
  placeholder?: string
  required?: boolean
}
```

### Response Data Structure
- Maintain existing response structure
- `transcription` field contains final text (typed + transcribed audio)
- `audio_url` field contains voice recording if provided
- Background processing combines both sources

### UI/UX Design
- Chat-like input field with text area and microphone button
- Microphone button positioned like send button in chat apps
- Voice recording shows inline or as overlay
- Seamless switching between text and voice input
- Visual feedback for recording state
