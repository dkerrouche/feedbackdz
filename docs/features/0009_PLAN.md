## Bugfix: Response Management Actions Not Working

### Context
Response actions (flag, mark addressed, save notes) are not working properly. The UI calls the actions but the database is not being updated or the UI is not refreshing to reflect changes.

### Issues to Fix

1) Flag response action not working
- Verify API endpoint `/api/responses/[id]` PATCH with action `flag`/`unflag` updates `is_flagged` and `flagged_at`.
- Check if UI properly reads `is_flagged` from response data.
- Ensure client calls with correct toggle logic.

2) Mark as addressed not working
- Verify API endpoint PATCH with action `mark_addressed`/`unmark_addressed` updates `is_addressed` and `addressed_at`.
- Check if UI properly reads `is_addressed` from response data.
- Ensure toggle logic passes current state correctly.

3) Save notes not working
- Verify API endpoint PATCH with action `update_notes` and `{ notes }` data updates `notes` field.
- Check if notes are being sent correctly from modal.
- Verify response after save includes updated notes.

### Files to Check/Fix

1) API Endpoint
- `src/app/api/responses/[id]/route.ts`:
  - Verify PATCH handler processes all actions correctly.
  - Ensure database updates return the updated row.
  - Check if fields `is_flagged`, `flagged_at`, `is_addressed`, `addressed_at`, `notes` exist in schema.

2) Client Library
- `src/lib/response-management.ts`:
  - Verify `updateResponse(id, action, data)` sends correct payload.
  - Check if response is parsed and returned properly.

3) UI Components
- `src/components/dashboard/ResponseFeed.tsx`:
  - Verify handlers pass correct current state to toggle actions.
  - Ensure `onResponsesChange()` triggers a refresh after actions.
- `src/components/dashboard/ResponseItem.tsx`:
  - Check if `isAddressed` and `isFlagged` props are read from response data.
- `src/components/dashboard/ResponseDetailModal.tsx`:
  - Verify notes save calls correct action with trimmed notes.
  - Check if modal reads current notes from response.

4) Database Schema
- Verify `responses` table has columns: `is_addressed`, `addressed_at`, `is_flagged`, `flagged_at`, `notes`.
- If missing, add migration SQL.

### Debugging Steps

1. Check browser console for API errors when clicking flag/address/save.
2. Inspect network tab to see if PATCH requests succeed and return updated data.
3. Query database directly to verify if fields exist and are being updated.
4. Add console logs in handlers to trace data flow.

### Expected Behavior After Fix

- Clicking "Flag" toggles `is_flagged` and UI shows "Flagged" state immediately.
- Clicking "Mark Addressed" toggles `is_addressed` and UI shows green addressed state.
- Saving notes in modal updates `notes` field and shows "Saved" indicator.
- List refreshes after any action to reflect server state.

### Out of Scope
- Optimistic UI updates (will refresh from server for now).
- Real-time sync across multiple tabs/users.

