## Feature: Dashboard Filters, Charts, and Realtime Analytics Refresh

### Context
We have working server endpoints for analytics (`/api/analytics`) and responses (`/api/responses`) plus CSV export. The dashboard already fetches analytics with a date range and shows realtime response inserts. Next, we need full filter UI (rating, sentiment, search, QR), a paginated responses list backed by the server API, charts powered by server datasets, and a lightweight realtime analytics refresh when new responses arrive.

### Files to Create/Change

1) Filters UI & Wiring
- `src/components/dashboard/ResponseFilters.tsx` (create or enhance):
  - Props: `value` (object of filters), `onChange(value)`, `surveys` (to populate QR list), and `disabled`.
  - Controls: date range (existing), rating multi-select (1–5), sentiment multi-select (positive/neutral/negative), search text, QR multi-select.
  - Debounce search input (300ms) and call `onChange` with normalized filters.
- `src/lib/response-filters.ts`:
  - Add helpers to convert filter object <-> URLSearchParams to sync with router and APIs.
- `src/app/dashboard/page.tsx`:
  - Hold unified filter state; sync to URL query; on change, fetch `/api/analytics` + `/api/responses` with params.
  - Keep date range controls or merge them into `ResponseFilters`.

2) Responses List & Pagination
- `src/components/dashboard/ResponseFeed.tsx`:
  - Add props: `items`, `total`, `page`, `limit`, `onPageChange`.
  - Render server-provided items (not only realtime state); on page change, call parent to fetch new page.
- `src/app/dashboard/page.tsx`:
  - Fetch `/api/responses?page=&limit=&...` using current filters; store `{ items, total, page, limit }`.
  - On realtime INSERT, prepend if it matches current filters and (if on first page) adjust list; otherwise trigger a silent analytics refetch.

3) Charts (server-backed datasets)
- `src/components/dashboard/DashboardCharts.tsx`:
  - Expect props: `trends` (array of { date, responses, averageRating }), `ratingDistribution` (counts by 1..5), `keywordCounts` (top N map).
  - Render: line area for trends, bar for rating distribution, tag cloud/list for top keywords.
- `src/app/api/analytics/route.ts` (if needed):
  - Ensure the response includes `trends`, `ratingDistribution`, `keywordCounts` (already produced by `calculateAnalytics`).

4) Realtime Analytics Refresh
- `src/hooks/useRealtimeResponses.ts`:
  - Expose a callback prop `onInsert?(response)` from the hook or return a function to subscribe.
- `src/app/dashboard/page.tsx`:
  - When realtime insert fires, if filters match and date range includes now, trigger a light `/api/analytics` refetch; throttle to avoid spam (e.g., once per 5s).

### Algorithms / Behaviors

1) Filter normalization
- `ratings`: sorted unique [1..5]; `sentiments`: subset of ['positive','neutral','negative']; `qrs`: unique list of strings.
- Search is case-insensitive; server uses `ILIKE` and keywords contains (`keywords.cs.{q}`) as implemented.
- Date range guards: ensure `start <= end`; clamp to today.

2) Pagination strategy
- Client holds `page`, `limit`. Changing filters resets to page 1.
- Server returns `{ items, total, page, limit }`; compute `pageCount = Math.ceil(total/limit)`.

3) Realtime update strategy
- If on page 1 and filters match, unshift new response locally; if page full, drop last item.
- Always throttle analytics refetch to 1 call per 5 seconds when new inserts arrive.

### Phases

Phase A — Filters & Responses List
- Build `ResponseFilters`, integrate into `dashboard/page.tsx`, wire `/api/responses` with pagination.

Phase B — Charts
- Update `DashboardCharts` to consume server datasets and render charts (Recharts).

Phase C — Realtime Analytics Refresh
- Add throttled analytics refetch on realtime inserts and matching filters.

### Out of Scope
- Auth changes, admin panel, PDF export, advanced chart drill-downs.


